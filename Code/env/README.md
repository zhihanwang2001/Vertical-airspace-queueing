# å‚ç›´åˆ†å±‚é˜Ÿåˆ—ç¯å¢ƒ (Vertical Stratified Queue Environment)

## ğŸ“– æ¦‚è¿°

æœ¬ç¯å¢ƒå®ç°äº†åŸºäºMCRPS/D/Kç†è®ºçš„å‚ç›´åˆ†å±‚é˜Ÿåˆ—ç³»ç»Ÿï¼Œç”¨äºæ— äººæœºé…é€ç³»ç»Ÿçš„æ·±åº¦å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–ç ”ç©¶ã€‚

æç¤ºï¼šæœ¬ä»“åº“åŒ…å«ä¸¤ä¸ªç¯å¢ƒå®ç°ä¾›ç ”ç©¶ä¸è®­ç»ƒä½¿ç”¨ï¼š
- DRLå›ºå®šç‰ˆï¼ˆç”¨äºè®­ç»ƒä¸å®éªŒï¼ŒDictè§‚æµ‹ï¼Œ29ç»´ï¼‰ï¼š`env.drl_optimized_env_fixed.DRLOptimizedQueueEnvFixed`
- ç†è®ºç‰ˆï¼ˆç”¨äºæœºåˆ¶ç ”ç©¶ä¸å¯è§†åŒ–ï¼Œå‘é‡è§‚æµ‹ï¼Œé«˜ç»´ï¼‰ï¼š`env.vertical_queue_env.VerticalQueueEnv`
æœ¬æ–‡æ¡£æè¿°çš„è§‚æµ‹/åŠ¨ä½œç©ºé—´ä¸è®­ç»ƒè„šæœ¬é»˜è®¤å¯¹åº”â€œDRLå›ºå®šç‰ˆâ€ã€‚

**æ ¸å¿ƒç‰¹æ€§**:
- ğŸ—ï¸ **5å±‚å‚ç›´åˆ†å±‚ç»“æ„**: é«˜åº¦åˆ†å±‚ [100m, 80m, 60m, 40m, 20m]
- ğŸ“Š **å€’é‡‘å­—å¡”å®¹é‡**: å®¹é‡é…ç½® [8, 6, 4, 3, 2] 
- ğŸ§  **29ç»´è§‚æµ‹ç©ºé—´**: å®Œæ•´çš„ç³»ç»ŸçŠ¶æ€è¡¨ç¤º
- ğŸ® **11ç»´æ··åˆåŠ¨ä½œ**: è¿ç»­æ§åˆ¶ + ç¦»æ•£å†³ç­–
- ğŸ¯ **å¤šç›®æ ‡ä¼˜åŒ–**: 6ä¸ªä¼˜åŒ–ç›®æ ‡çš„å¹³è¡¡

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºç¡€ä½¿ç”¨

```python
from env.drl_optimized_env_fixed import DRLOptimizedQueueEnvFixed

# åˆ›å»ºç¯å¢ƒ
env = DRLOptimizedQueueEnvFixed()

# é‡ç½®ç¯å¢ƒ
obs, info = env.reset()

# éšæœºåŠ¨ä½œæµ‹è¯•
for step in range(100):
    action = env.action_space.sample()
    obs, reward, terminated, truncated, info = env.step(action)
    
    if terminated or truncated:
        obs, info = env.reset()
```

### ä¸DRLæ¡†æ¶é›†æˆ

```python
from baselines.space_utils import SB3DictWrapper
from stable_baselines3 import PPO

# ç¯å¢ƒåŒ…è£… (é€‚é…Stable-Baselines3)
env = DRLOptimizedQueueEnvFixed()
wrapped_env = SB3DictWrapper(env)

# è®­ç»ƒæ¨¡å‹
model = PPO("MultiInputPolicy", wrapped_env, verbose=1)
model.learn(total_timesteps=100000)
```

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### å‚ç›´åˆ†å±‚ç»“æ„

| å±‚çº§ | é«˜åº¦ | å®¹é‡ | æœåŠ¡ç‡ | åˆ°è¾¾æƒé‡ |
|------|------|------|--------|----------|
| L1 | 100m | 8 | 1.2 | 0.30 |
| L2 | 80m | 6 | 1.0 | 0.25 |
| L3 | 60m | 4 | 0.8 | 0.20 |
| L4 | 40m | 3 | 0.6 | 0.15 |
| L5 | 20m | 2 | 0.4 | 0.10 |

**è®¾è®¡ç†å¿µ**:
- **å€’é‡‘å­—å¡”å®¹é‡**: åæ˜ çœŸå®ç©ºåŸŸç‰©ç†çº¦æŸ
- **ä¸Šå‡æœåŠ¡ä¼˜å…ˆ**: é«˜å±‚å¿«é€Ÿå¤„ç†(Î¼5=1.5)ï¼Œä½å±‚ç²¾ç»†æœåŠ¡(Î¼1=0.8)
- **å·®å¼‚åŒ–åˆ°è¾¾**: é«˜å±‚æ‰¿æ‹…æ›´å¤šæµé‡è´Ÿè½½

## ğŸ“Š è§‚æµ‹ç©ºé—´ (29ç»´)

è§‚æµ‹ç©ºé—´ä¸ºDictæ ¼å¼ï¼ŒåŒ…å«7ä¸ªä¸»è¦ç»„ä»¶ï¼š

```python
observation_space = spaces.Dict({
    'queue_lengths':     Box(shape=(5,)),  # å„å±‚é˜Ÿåˆ—é•¿åº¦ [0, max_capacity]
    'utilization_rates': Box(shape=(5,)),  # å„å±‚åˆ©ç”¨ç‡ [0.0, 1.0]
    'queue_changes':     Box(shape=(5,)),  # é˜Ÿåˆ—å˜åŒ–è¶‹åŠ¿ [-1.0, 1.0]
    'load_rates':        Box(shape=(5,)),  # å®é™…è´Ÿè½½ç‡ [0.0, 5.0]
    'service_rates':     Box(shape=(5,)),  # å½“å‰æœåŠ¡ç‡ [0.0, 10.0]
    'prev_reward':       Box(shape=(1,)),  # å†å²å¥–åŠ± [-100.0, 100.0]
    'system_metrics':    Box(shape=(3,)),  # ç³»ç»ŸæŒ‡æ ‡ [0.0, 10.0]
})
```

**ç»´åº¦è¯¦è§£**:
- **queue_lengths** (5ç»´): å½“å‰å„å±‚é˜Ÿåˆ—ä¸­çš„UAVæ•°é‡
- **utilization_rates** (5ç»´): å„å±‚å®¹é‡åˆ©ç”¨ç‡ = queue_length / capacity
- **queue_changes** (5ç»´): ç›¸å¯¹ä¸Šä¸€æ­¥çš„é˜Ÿåˆ—é•¿åº¦å˜åŒ–
- **load_rates** (5ç»´): è´Ÿè½½ç³»æ•° Ï = Î»_eff / (Î¼ Ã— capacity)
- **service_rates** (5ç»´): åŠ¨æ€è°ƒæ•´åçš„å®é™…æœåŠ¡ç‡
- **prev_reward** (1ç»´): ä¸Šä¸€æ­¥çš„å¥–åŠ±å€¼ï¼Œç”¨äºå¥–åŠ±è¶‹åŠ¿å­¦ä¹ 
- **system_metrics** (3ç»´): [æ€»è´Ÿè½½, æ€»åˆ©ç”¨ç‡, ç¨³å®šæ€§æŒ‡æ ‡]

**æ€»è®¡**: 5+5+5+5+5+1+3 = **29ç»´**

## ğŸ® åŠ¨ä½œç©ºé—´ (11ç»´æ··åˆ)

åŠ¨ä½œç©ºé—´ä¸ºDictæ ¼å¼ï¼ŒåŒ…å«è¿ç»­æ§åˆ¶å’Œç¦»æ•£å†³ç­–ï¼š

```python
action_space = spaces.Dict({
    'service_intensities': Box([0.1, 2.0], shape=(5,)),  # è¿ç»­: æœåŠ¡å¼ºåº¦è°ƒèŠ‚
    'arrival_multiplier':  Box([0.5, 5.0], shape=(1,)),  # è¿ç»­: å…¨å±€åˆ°è¾¾å€æ•°
    'emergency_transfers': MultiBinary(5)                # ç¦»æ•£: ç´§æ€¥è½¬ç§»å†³ç­–
})
```

**åŠ¨ä½œè¯¦è§£**:
- **service_intensities** (5ç»´è¿ç»­): å„å±‚æœåŠ¡å¼ºåº¦è°ƒèŠ‚å€æ•° [0.1, 2.0]
  - æ§åˆ¶å„å±‚çš„æœåŠ¡å¤„ç†é€Ÿåº¦
  - å€¼>1.0è¡¨ç¤ºåŠ é€ŸæœåŠ¡ï¼Œ<1.0è¡¨ç¤ºå‡ç¼“æœåŠ¡
- **arrival_multiplier** (1ç»´è¿ç»­): å…¨å±€åˆ°è¾¾ç‡è°ƒèŠ‚ [0.5, 5.0]
  - æ§åˆ¶æ•´ä½“ç³»ç»Ÿçš„ä»»åŠ¡åˆ°è¾¾å¼ºåº¦
  - ç”¨äºåŠ¨æ€è´Ÿè½½ç®¡ç†
- **emergency_transfers** (5ç»´ç¦»æ•£): ç´§æ€¥è½¬ç§»è§¦å‘ {0, 1}
  - æ¯å±‚ä¸€ä¸ªäºŒè¿›åˆ¶å¼€å…³
  - 1è¡¨ç¤ºè§¦å‘è¯¥å±‚çš„ç´§æ€¥ä¸‹æ²‰è½¬ç§»

**æ€»è®¡**: 5+1+5 = **11ç»´**

## ğŸ¯ å¥–åŠ±å‡½æ•° (6ç›®æ ‡ä¼˜åŒ–)

ç³»ç»Ÿé‡‡ç”¨å¤šç›®æ ‡å¥–åŠ±å‡½æ•°ï¼Œå¹³è¡¡6ä¸ªå…³é”®æŒ‡æ ‡ï¼š

### å¥–åŠ±ç»„ä»¶

```python
def _calculate_reward_fixed(self, action) -> float:
    # 1. ååé‡å¥–åŠ± (ä¸»è¦ç›®æ ‡)
    R_throughput = 10.0 * np.sum(service_counts)
    
    # 2. åŸºå°¼ç³»æ•°è´Ÿè½½å‡è¡¡ (å…¬å¹³æ€§)
    gini = self._calculate_gini_coefficient(utilization_rates)
    R_balance = 5.0 * (1.0 - gini)
    
    # 3. èƒ½æ•ˆä¼˜åŒ– (æ•ˆç‡)
    R_efficiency = 3.0 * total_service / total_energy
    
    # 4. æ‹¥å µæƒ©ç½š (ç¨³å®šæ€§)
    P_congestion = -20.0 * np.sum(congestion_levels)
    
    # 5. ç³»ç»Ÿç¨³å®šæ€§ (é²æ£’æ€§)
    P_instability = -15.0 * instability_penalty
    
    # 6. ç´§æ€¥è½¬ç§»æˆæœ¬ (æ§åˆ¶å¤æ‚åº¦)
    P_transfer = -5.0 * np.sum(emergency_transfers)
    
    return R_throughput + R_balance + R_efficiency + P_congestion + P_instability + P_transfer
```

### ç›®æ ‡æƒé‡

| ç›®æ ‡ | æƒé‡ | è¯´æ˜ |
|------|------|------|
| ååé‡æœ€å¤§åŒ– | 10.0 | ç³»ç»Ÿå¤„ç†èƒ½åŠ› |
| è´Ÿè½½å‡è¡¡ | 5.0 | åŸºå°¼ç³»æ•°å…¬å¹³æ€§ |
| èƒ½æ•ˆä¼˜åŒ– | 3.0 | æœåŠ¡/èƒ½è€—æ¯” |
| æ‹¥å µæƒ©ç½š | -20.0 | é˜²æ­¢ç³»ç»Ÿè¿‡è½½ |
| ç¨³å®šæ€§æƒ©ç½š | -15.0 | ä¿æŒç³»ç»Ÿç¨³å®š |
| è½¬ç§»æˆæœ¬ | -5.0 | æ§åˆ¶åŠ¨ä½œå¤æ‚åº¦ |

## âš™ï¸ ç³»ç»Ÿå‚æ•°

### æ ¸å¿ƒé…ç½®
```python
# ç‰©ç†ç»“æ„
n_layers = 5
heights = [100, 80, 60, 40, 20]  # ç±³
capacities = [8, 6, 4, 3, 2]     # å€’é‡‘å­—å¡”å®¹é‡

# åˆ°è¾¾è¿‡ç¨‹
base_arrival_rate = 0.3                    # Î»â‚€ = 0.3/step
arrival_weights = [0.3, 0.25, 0.2, 0.15, 0.1]  # Î±_i

# æœåŠ¡è¿‡ç¨‹  
base_service_rates = [1.2, 1.0, 0.8, 0.6, 0.4]  # Î¼_i

# ç¯å¢ƒå‚æ•°
max_episode_steps = 200  # å›åˆæ—¶é—´é™åˆ¶
render_modes = ["human"]
```

### åŠ¨åŠ›å­¦æ¨¡å‹

**åˆ°è¾¾è¿‡ç¨‹**: æ³Šæ¾åˆ°è¾¾ + å¤šé¡¹å¼åˆ†æµ
```
Î»_total(t) = base_arrival_rate Ã— arrival_multiplier(t)
Î»_i(t) = Î»_total(t) Ã— arrival_weights[i]
```

**æœåŠ¡è¿‡ç¨‹**: çŠ¶æ€ä¾èµ–æœåŠ¡ç‡
```
Î¼_i(t) = base_service_rates[i] Ã— service_intensities[i](t)
```

**è½¬ç§»åŠ¨åŠ›å­¦**: å‹åŠ›è§¦å‘ + ç´§æ€¥è½¬ç§»
```
transfer_rate_i = f(queue_length_i, utilization_i, emergency_transfers[i])
```

## ğŸ”¬ MCRPS/D/K ç†è®ºåŸºç¡€

æœ¬ç¯å¢ƒå®ç°äº†å…¨æ–°çš„æ’é˜Ÿç½‘ç»œç±»å‹ï¼š**MCRPS/D/K**ï¼Œè¿™æ˜¯åŸºäºæ·±åº¦å¼ºåŒ–å­¦ä¹ çš„å‚ç›´åˆ†å±‚æ’é˜Ÿä¼˜åŒ–ç†è®ºçš„æ ¸å¿ƒåˆ›æ–°ã€‚

### ç†è®ºåˆ†ç±»
- **MC**: Multi-layer Correlated arrivals (å¤šå±‚ç›¸å…³åˆ°è¾¾)
- **R**: Random batch service (éšæœºæ‰¹é‡æœåŠ¡)
- **P**: Poisson splitting (æ³Šæ¾åˆ†æµ)
- **S**: State-dependent (çŠ¶æ€ä¾èµ–)
- **D**: Dynamic transfer (åŠ¨æ€è½¬ç§»)
- **K**: Finite capacity (æœ‰é™å®¹é‡)

### åˆ›æ–°ç³»ç»ŸåŠ¨åŠ›å­¦

#### 1. ç›¸å…³åˆ°è¾¾è¿‡ç¨‹ (MC + P)
```mathematical
Nâ‚œ ~ Poisson(Î»â‚€Î¼â‚œ)                    # æ€»åˆ°è¾¾æ³Šæ¾åˆ†å¸ƒ
(Nâ‚â‚œ, ..., Nâ‚…â‚œ) ~ Multinomial(Nâ‚œ, w)  # å¤šé¡¹å¼åˆ†æµ
å®é™…åˆ°è¾¾ï¼šmin(Náµ¢â‚œ, cáµ¢ - qáµ¢â‚œ)          # å®¹é‡çº¦æŸåˆ°è¾¾
```
**åˆ›æ–°ç‰¹å¾**: å±‚é—´ç›¸å…³åˆ°è¾¾ vs ä¼ ç»Ÿç‹¬ç«‹åˆ°è¾¾

#### 2. æ‰¹é‡æœåŠ¡è¿‡ç¨‹ (R)
```mathematical
Dáµ¢â‚œ = min(max(1, Poisson(sâ‚€áµ¢Î±áµ¢â‚œ)), qáµ¢â‚œ)
```
**åˆ›æ–°ç‰¹å¾**: éé›¶æ‰¹é‡æœåŠ¡ä¿è¯ vs ä¼ ç»Ÿå•ä½“æœåŠ¡

#### 3. åŠ¨æ€è½¬ç§»æœºåˆ¶ (D)
```mathematical
å½“Ï„áµ¢â‚œ = 1ä¸”i < 5æ—¶ï¼š
å‹åŠ›ç³»æ•°ï¼špáµ¢ = qáµ¢â‚œ/cáµ¢
è½¬ç§»æ•°é‡ï¼šTáµ¢â‚œ = min(âŒŠqáµ¢â‚œ Ã— min(0.8, páµ¢)âŒ‹, cáµ¢â‚Šâ‚ - qáµ¢â‚Šâ‚â‚œ)
```
**åˆ›æ–°ç‰¹å¾**: å‹åŠ›è§¦å‘è·¨å±‚è½¬ç§» vs ä¼ ç»Ÿé™æ€ç½‘ç»œ

### ä¸ç»å…¸æ’é˜Ÿç†è®ºå¯¹æ¯”

| ç‰¹å¾ | ç»å…¸æ’é˜Ÿè®º | MCRPS/D/K |
|------|------------|-----------|
| **ç©ºé—´ç»“æ„** | æŠ½è±¡èŠ‚ç‚¹ | ç‰©ç†å‚ç›´åˆ†å±‚ |
| **åˆ°è¾¾è¿‡ç¨‹** | ç‹¬ç«‹æ³Šæ¾ | ç›¸å…³+åˆ†æµ |
| **æœåŠ¡æœºåˆ¶** | å•ä½“æŒ‡æ•° | æ‰¹é‡+éé›¶ä¿è¯ |
| **ç½‘ç»œæ‹“æ‰‘** | é™æ€è¿æ¥ | åŠ¨æ€è½¬ç§» |
| **å®¹é‡è®¾è®¡** | å‡åŒ€/é€’å¢ | å€’é‡‘å­—å¡” |
| **æ§åˆ¶æ–¹å¼** | å‚æ•°å›ºå®š | DRLå®æ—¶ä¼˜åŒ– |

### ç†è®ºåˆ›æ–°ä»·å€¼

1. **å‚ç›´åˆ†å±‚æ’é˜Ÿ**: é¦–åˆ›ç‰©ç†ç©ºé—´åˆ†å±‚çš„æ’é˜Ÿç½‘ç»œï¼Œå¡«è¡¥ç©ºåŸŸç®¡ç†ç†è®ºç©ºç™½
2. **å€’é‡‘å­—å¡”å®¹é‡**: åæ˜ çœŸå®ç©ºåŸŸçº¦æŸçš„å®¹é‡è®¾è®¡ï¼Œé«˜å±‚å®¹é‡å¤§ä½†å—ç‰©ç†é™åˆ¶é€’å‡
3. **å‹åŠ›è§¦å‘è½¬ç§»**: åŸºäºæ‹¥å¡å‹åŠ›çš„è·¨å±‚åŠ¨æ€è½¬ç§»ï¼Œå®ç°æ™ºèƒ½è´Ÿè½½å‡è¡¡
4. **å¤šç›®æ ‡å¹³è¡¡**: 6ç›®æ ‡æƒè¡¡çš„æ™ºèƒ½è°ƒåº¦ç­–ç•¥ï¼Œå…¼é¡¾æ•ˆç‡ã€å…¬å¹³æ€§ã€ç¨³å®šæ€§
5. **ç†è®ºçªç ´**: åˆ›é€ å…¨æ–°æ’é˜Ÿç³»ç»Ÿç±»å‹ï¼Œæ— ç»å…¸è§£æè§£ï¼Œéœ€è¦ä»¿çœŸåˆ†æ

### æ–‡çŒ®ç†è®ºæ”¯æ’‘

åŸºäºã€Šæ’é˜Ÿè®ºä¸ç©ºåŸŸç®¡ç†æ–‡çŒ®ç»¼è¿°ã€‹åˆ†æï¼Œç°æœ‰ç ”ç©¶å­˜åœ¨ä»¥ä¸‹å±€é™ï¼š

- **[4] Vertiportå®¹é‡è¯„ä¼°**: ä»…è€ƒè™‘å•å±‚M/M/1å’ŒM/M/cï¼Œç¼ºä¹å‚ç›´åˆ†å±‚
- **[11] ç©ºåŸŸç½‘ç»œè®¾è®¡**: 3Dèµ°å»Šåˆ†æ®µå»ºæ¨¡ï¼Œä½†æ— åŠ¨æ€å±‚é—´è½¬ç§»
- **[5] ç©ºä¸­äº¤é€šæµç®¡ç†**: MILPä¼˜åŒ–ç¼ºä¹å®æ—¶å­¦ä¹ èƒ½åŠ›

**æˆ‘ä»¬çš„çªç ´**: MCRPS/D/Kç†è®ºå¡«è¡¥äº†å‚ç›´åˆ†å±‚åŠ¨æ€æ’é˜Ÿçš„ç†è®ºç©ºç™½ï¼Œå®ç°äº†ä»é™æ€ç½‘ç»œè®¾è®¡åˆ°æ™ºèƒ½å®æ—¶è°ƒåº¦çš„è·ƒè¿›ã€‚

## ğŸ›ï¸ ç³»ç»Ÿç¯å¢ƒæ¶æ„æ€»ç»“

### æ•´ä½“æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                DRLOptimizedQueueEnvFixed                    â”‚
â”‚                 (29ç»´çŠ¶æ€ + 11ç»´æ··åˆåŠ¨ä½œ)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 1 (100m) â”‚ Capacity: 8 â”‚ Service: 1.2 â”‚ Weight: 0.30â”‚
â”‚  Layer 2 (80m)  â”‚ Capacity: 6 â”‚ Service: 1.0 â”‚ Weight: 0.25â”‚
â”‚  Layer 3 (60m)  â”‚ Capacity: 4 â”‚ Service: 0.8 â”‚ Weight: 0.20â”‚
â”‚  Layer 4 (40m)  â”‚ Capacity: 3 â”‚ Service: 0.6 â”‚ Weight: 0.15â”‚
â”‚  Layer 5 (20m)  â”‚ Capacity: 2 â”‚ Service: 0.4 â”‚ Weight: 0.10â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ³Šæ¾åˆ°è¾¾      â”‚   å¤šé¡¹å¼åˆ†æµ   â”‚   æ‰¹é‡æœåŠ¡     â”‚  å‹åŠ›è½¬ç§»   â”‚
â”‚ Poisson(0.3Î¼â‚œ)  â”‚ Multinomial   â”‚ max(1,Pois.) â”‚ è§¦å‘è·¨å±‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶æ¶æ„

#### 1. çŠ¶æ€ç®¡ç†å­ç³»ç»Ÿ (StateManager)
- **åŠŸèƒ½**: 29ç»´çŠ¶æ€ç©ºé—´æ„å»ºå’Œæ›´æ–°
- **ç»„ä»¶**: é˜Ÿåˆ—çŠ¶æ€ã€åˆ©ç”¨ç‡ã€è´Ÿè½½ç‡ã€ç³»ç»ŸæŒ‡æ ‡
- **ç‰¹ç‚¹**: å®æ—¶çŠ¶æ€æ ‡å‡†åŒ–å’Œå†å²è®°å½•

#### 2. é˜Ÿåˆ—åŠ¨åŠ›å­¦å­ç³»ç»Ÿ (QueueDynamics) 
- **åŠŸèƒ½**: MCRPS/D/Kç†è®ºçš„æ ¸å¿ƒå®ç°
- **ç»„ä»¶**: ç›¸å…³åˆ°è¾¾ã€æ‰¹é‡æœåŠ¡ã€åŠ¨æ€è½¬ç§»
- **ç‰¹ç‚¹**: éæ ‡å‡†æ’é˜Ÿè¿‡ç¨‹çš„æ•°å­¦å»ºæ¨¡

#### 3. å¥–åŠ±ä¼˜åŒ–å­ç³»ç»Ÿ (RewardFunction)
- **åŠŸèƒ½**: 6ç›®æ ‡å¤šæƒè¡¡ä¼˜åŒ–
- **ç»„ä»¶**: ååé‡ã€å…¬å¹³æ€§ã€æ•ˆç‡ã€ç¨³å®šæ€§
- **ç‰¹ç‚¹**: æ•°å­¦ä¸¥è°¨çš„åŸºå°¼ç³»æ•°è´Ÿè½½å‡è¡¡

#### 4. åŠ¨ä½œæ§åˆ¶å­ç³»ç»Ÿ (ActionProcessor)
- **åŠŸèƒ½**: 11ç»´æ··åˆåŠ¨ä½œç©ºé—´å¤„ç†
- **ç»„ä»¶**: è¿ç»­æœåŠ¡æ§åˆ¶ + ç¦»æ•£è½¬ç§»å†³ç­–
- **ç‰¹ç‚¹**: å®æ—¶å‚æ•°è°ƒèŠ‚å’Œç´§æ€¥å“åº”

### ç³»ç»Ÿé›†æˆç‰¹æ€§

#### ğŸ“Š æ•°æ®æµæ¶æ„
```
ç¯å¢ƒçŠ¶æ€ â†’ StateManager â†’ 29ç»´è§‚æµ‹å‘é‡
     â†“
DRLæ™ºèƒ½ä½“ â†’ ç­–ç•¥ç½‘ç»œ â†’ 11ç»´æ··åˆåŠ¨ä½œ
     â†“
ActionProcessor â†’ å‚æ•°è§£æ â†’ ç³»ç»Ÿæ§åˆ¶ä¿¡å·
     â†“
QueueDynamics â†’ MCRPS/D/K â†’ çŠ¶æ€æ›´æ–°
     â†“
RewardFunction â†’ 6ç›®æ ‡è¯„ä¼° â†’ å¥–åŠ±åé¦ˆ
```

#### ğŸ”„ æ§åˆ¶å¾ªç¯è®¾è®¡
1. **è§‚æµ‹é˜¶æ®µ**: æå–29ç»´ç³»ç»ŸçŠ¶æ€
2. **å†³ç­–é˜¶æ®µ**: DRLç”Ÿæˆ11ç»´æ··åˆåŠ¨ä½œ
3. **æ‰§è¡Œé˜¶æ®µ**: åŠ¨ä½œè§£æä¸ºç³»ç»Ÿå‚æ•°è°ƒæ•´
4. **æ›´æ–°é˜¶æ®µ**: MCRPS/D/KåŠ¨åŠ›å­¦çŠ¶æ€è½¬ç§»
5. **è¯„ä¼°é˜¶æ®µ**: å¤šç›®æ ‡å¥–åŠ±è®¡ç®—å’Œåé¦ˆ

#### âš¡ å®æ—¶å“åº”æœºåˆ¶
- **æ­£å¸¸æ¨¡å¼**: åŸºäºDRLç­–ç•¥çš„æ™ºèƒ½è°ƒåº¦
- **ç´§æ€¥æ¨¡å¼**: å‹åŠ›è§¦å‘çš„è·¨å±‚å¿«é€Ÿè½¬ç§»
- **ç¨³å®šä¿è¯**: æ•°å­¦çº¦æŸç¡®ä¿ç³»ç»Ÿä¸å´©æºƒ
- **æ€§èƒ½ç›‘æ§**: å®æ—¶è´Ÿè½½ç‡å’Œç¨³å®šæ€§æ£€æµ‹

### æŠ€æœ¯åˆ›æ–°æ€»ç»“

#### ğŸ§  ç†è®ºå±‚é¢
- **åŸåˆ›ç†è®º**: MCRPS/D/Kå‚ç›´åˆ†å±‚æ’é˜Ÿç½‘ç»œ
- **æ•°å­¦ä¸¥è°¨**: åŸºäºä»¿çœŸçš„æ–°å‹æ’é˜Ÿç³»ç»Ÿåˆ†æ
- **ç©ºç™½å¡«è¡¥**: å‚ç›´ç©ºåŸŸç®¡ç†çš„ç†è®ºåŸºç¡€

#### ğŸ› ï¸ å·¥ç¨‹å±‚é¢  
- **æ¨¡å—åŒ–è®¾è®¡**: é«˜å†…èšä½è€¦åˆçš„ç³»ç»Ÿæ¶æ„
- **æ··åˆåŠ¨ä½œ**: è¿ç»­+ç¦»æ•£çš„å¤æ‚æ§åˆ¶ç©ºé—´
- **å®æ—¶ä¼˜åŒ–**: DRLé©±åŠ¨çš„åŠ¨æ€å‚æ•°è°ƒèŠ‚

#### ğŸ“ˆ æ€§èƒ½å±‚é¢
- **æ”¶æ•›ç¨³å®š**: 15ç§ç®—æ³•éªŒè¯çš„ç¯å¢ƒç¨³å®šæ€§
- **æ€§èƒ½çªç ´**: DRLç›¸æ¯”ä¼ ç»Ÿæ–¹æ³•æå‡50%+
- **é²æ£’æ€§å¼º**: å¤šç§è´Ÿè½½æ¡ä»¶ä¸‹çš„ç¨³å®šè¡¨ç°

### ä¸ç°æœ‰ç³»ç»Ÿå¯¹æ¯”

| ç»´åº¦ | ä¼ ç»Ÿæ’é˜Ÿç³»ç»Ÿ | ç°æœ‰UAVç®¡ç† | MCRPS/D/Kç¯å¢ƒ |
|------|-------------|-------------|---------------|
| **ç©ºé—´æ¨¡å‹** | æŠ½è±¡ç½‘ç»œ | å‡ ä½•è§„åˆ’ | ç‰©ç†å‚ç›´åˆ†å±‚ |
| **è°ƒåº¦æ–¹å¼** | é™æ€è§„åˆ™ | å¯å‘å¼ç®—æ³• | DRLå®æ—¶å­¦ä¹  |
| **çŠ¶æ€ç»´åº¦** | ç®€å•æŒ‡æ ‡ | ä½ç½®é€Ÿåº¦ | 29ç»´ç³»ç»ŸçŠ¶æ€ |
| **æ§åˆ¶ç²¾åº¦** | å‚æ•°å›ºå®š | è·¯å¾„æ§åˆ¶ | 11ç»´æ··åˆåŠ¨ä½œ |
| **ç†è®ºåŸºç¡€** | ç»å…¸æ’é˜Ÿ | è¿ç­¹ä¼˜åŒ– | MCRPS/D/Kç†è®º |
| **é€‚åº”èƒ½åŠ›** | é™æ€é…ç½® | åŠåŠ¨æ€ | å®Œå…¨è‡ªé€‚åº” |

è¿™ç§æ¶æ„è®¾è®¡å®ç°äº†ä»ç†è®ºåˆ›æ–°åˆ°å·¥ç¨‹å®ç°çš„å®Œæ•´é“¾è·¯ï¼Œä¸ºå‚ç›´ç©ºåŸŸç®¡ç†æä¾›äº†å…¨æ–°çš„æŠ€æœ¯èŒƒå¼ã€‚

## ğŸ“ˆ æ€§èƒ½åŸºå‡†

### å®éªŒéªŒè¯ç»“æœ

åŸºäº500k timestepsçš„å¤§è§„æ¨¡å®éªŒï¼š

| ç®—æ³• | å¹³å‡å¥–åŠ± | æ ‡å‡†å·® | è®­ç»ƒæ—¶é—´ | æ”¶æ•›æ€§ |
|------|----------|--------|----------|--------|
| **PPO** | **4419.98** | 135.71 | 30.8min | â­â­â­â­â­ |
| **TD7** | **4392.52** | 84.60 | 382.4min | â­â­â­â­â­ |
| **R2D2** | **4289.22** | 82.23 | 115.7min | â­â­â­â­ |
| SAC v2 | 4282.94 | 80.70 | 287.0min | â­â­â­â­ |
| Heuristic | 2860.69 | 87.96 | 1.1min | â­â­â­ |

**å…³é”®å‘ç°**:
- DRLç®—æ³•ç›¸æ¯”å¯å‘å¼æå‡ **50%+**
- æœ€ä½³ç®—æ³•å®ç° **>4400** å¹³å‡å¥–åŠ±
- æ ‡å‡†å·®æ§åˆ¶åœ¨ **<200**ï¼Œè¯æ˜ç¯å¢ƒç¨³å®šæ€§

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ‰©å±•ç¯å¢ƒ

```python
class CustomVerticalQueueEnv(DRLOptimizedQueueEnvFixed):
    def __init__(self, custom_config):
        super().__init__()
        # è‡ªå®šä¹‰é…ç½®
        self.custom_param = custom_config
    
    def _calculate_reward_fixed(self, action):
        # è‡ªå®šä¹‰å¥–åŠ±å‡½æ•°
        base_reward = super()._calculate_reward_fixed(action)
        custom_bonus = self._calculate_custom_bonus()
        return base_reward + custom_bonus
```

### æ·»åŠ æ–°è§‚æµ‹

```python
def _get_enhanced_observation(self):
    base_obs = self._get_observation()
    
    # æ·»åŠ æ–°çš„è§‚æµ‹ç»´åº¦
    enhanced_obs = base_obs.copy()
    enhanced_obs['custom_metrics'] = self._calculate_custom_metrics()
    
    return enhanced_obs
```

### è°ƒè¯•å·¥å…·

```python
# å¯ç”¨è¯¦ç»†è¾“å‡º
env = DRLOptimizedQueueEnvFixed(render_mode="human")

# çŠ¶æ€æ£€æŸ¥
print(f"Current state: {env._get_observation()}")
print(f"Queue lengths: {env.queue_lengths}")
print(f"Utilization: {env.queue_lengths / env.capacities}")
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **ç†è®ºåŸºç¡€**: `docs/å‚ç›´åˆ†å±‚æ’é˜Ÿç†è®º_æœ€ç»ˆç‰ˆ.md`
- **å®éªŒæŒ‡å—**: `docs/README_EXPERIMENT.md`
- **ä»£ç æ¶æ„**: `docs/RP1é¡¹ç›®æ ¸å¿ƒä»£ç æ¶æ„åˆ†æ.md`
- **åˆ›æ–°åˆ†æ**: `docs/åˆ›æ–°ç‚¹åˆ†ææŠ¥å‘Š.md`

## ğŸ¤ æ”¯æŒä¸è´¡çŒ®

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·å‚è€ƒé¡¹ç›®æ–‡æ¡£æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚

**ç‰ˆæœ¬**: v1.0.0  
**æ›´æ–°æ—¶é—´**: 2025-09-29  
**é¡¹ç›®çŠ¶æ€**: Production Ready âœ…
